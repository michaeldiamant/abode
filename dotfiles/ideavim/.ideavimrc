set number
set relativenumber
set scrolloff=2
set visualbell
set showmode
set showcmd

set ignorecase
set smartcase
set incsearch
set hlsearch

" Set conflicting handler preferences
sethandler <C-i> n-v-i:vim
sethandler <C-o> n-v-i:vim
sethandler <C-d> n-v-i:vim
sethandler <C-u> n-v-i:vim
sethandler <C-h> n-v-i:vim
sethandler <C-j> n-v-i:vim
sethandler <C-k> n-v-i:vim
sethandler <C-l> n-v-i:vim

nnoremap \e :e ~/.ideavimrc<CR>
nnoremap \s :action IdeaVim.ReloadVimRc.reload<CR>

let mapleader=" "

set commentary " https://github.com/tpope/vim-commentary
set surround " https://github.com/tpope/vim-surround
set highlightedyank
set quickscope

" Copy into system clipboard
nnoremap <C-y> "+y
nnoremap <C-yy> "+yy
vnoremap <C-y> "+y

" Center screen when jumping to next match
nnoremap n nzz
nnoremap N Nzz
vnoremap n nzz
vnoremap N Nzz

" Center screen when moving up and down
nnoremap <C-u> <C-u>zz
nnoremap <C-o> <C-d>zz
vnoremap <C-u> <C-u>zz
vnoremap <C-o> <C-d>zz

" Pane navigation
nnoremap <C-h> <C-w>h
nnoremap <C-l> <C-w>l
nnoremap <C-k> <C-w>k
nnoremap <C-j> <C-w>j
nnoremap <C-m> :action MaximizeEditorInSplit<CR>

" Switch between projects
nnoremap <leader>w :action WindowMenu<cr>

" Code navigation
nnoremap \f :action ActivateFindToolWindow<cr>
nnoremap \p :action ActivateProblemsViewToolWindow<cr>
nnoremap <leader>t :action ActivateTerminalToolWindow<cr>
nnoremap \r :action ActivateRunToolWindow<cr>
nnoremap <leader>t :action ActivateTerminalToolWindow<cr>
nnoremap \b :action ActivateBuildToolWindow<cr>
nnoremap <leader>b :action CompileDirty<cr>
nnoremap <leader>S :action SelectInProjectView<cr>
nnoremap <leader>o :action ActivateStructureToolWindow<cr>

nnoremap <leader>j :action MethodDown<cr>
nnoremap <leader>k :action MethodUp<cr>
nnoremap \f :action ActivateFindToolWindow<cr>
nnoremap cu :action ShowUsages<cr>
nnoremap cU :action FindUsages<cr>
nnoremap <leader>hc :action CallHierarchy<cr>
nnoremap <leader>ht :action TypeHierarchy<cr>
nnoremap <leader>c :action GotoClass<cr>
nnoremap <leader>fs :action GotoSymbol<cr>
nnoremap <leader>ff :action GotoFile<cr>
nnoremap <leader>fg :action FindInPath<cr>
nnoremap <leader>fS :action FileStructurePopup<cr>
nnoremap gd :action GotoDeclaration<cr>
nnoremap gD :action GotoTypeDeclaration<cr>
nnoremap <leader>i :action GotoImplementation<cr>
nnoremap <leader>a :action ShowIntentionActions<cr>
nnoremap <leader><S-e> :action GotoPreviousError<cr>
nnoremap <leader>e :action GotoNextError<cr>

" Wrap text with https://plugins.jetbrains.com/plugin/7234-wrap-to-column
nmap gqq :action com.andrewbrookins.idea.wrap.WrapAction<CR>
vmap gq :action com.andrewbrookins.idea.wrap.WrapAction<CR>

" Common actions
nnoremap <leader>oi :action OrganizeImports<cr>
nnoremap <leader>r :action Run<cr>
nnoremap <leader><S-r> :action RunClass<cr>
nnoremap <leader>n :action RenameElement<cr>

" Move lines
vnoremap J :m '>+1<cr>gv=gv
vnoremap K :m '<-2<cr>gv=gv
vnoremap < <gv
vnoremap > >gv

" Built-in navigation to navigated items works better
nmap <c-o> <Action>(Back)
nmap <c-i> <Action>(Forward)

" Diff
nnoremap ]c :action VcsShowNextChangeMarker<cr>
nnoremap [c :action VcsShowPrevChangeMarker<cr>
nnoremap <leader>hd :action Vcs.ShowDiffChangedLines<cr>
nnoremap <leader>hD :action Compare.SameVersion<cr>
nnoremap <leader>gb :action Git.CompareWithBranch<cr>
nnoremap <leader>hr :action Vcs.RollbackChangedLines<cr>

" Don't yank overridden text when pasting in visual mode
vnoremap <leader>p "_dP

nnoremap g; :action JumpToLastChange<Enter>
nnoremap g, :action JumpToNextChange<Enter>

" https://plugins.jetbrains.com/plugin/8183-gitlink
nnoremap <leader>gx :action uk.co.ben_gibson.git.link.ui.actions.menu.BrowserAction<cr>
" https://plugins.jetbrains.com/plugin/8262-find-pull-request
nnoremap <leader>yp :action com.github.shiraji.findpullrequest.action.FindPullRequestCopyAction<cr>